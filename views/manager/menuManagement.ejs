<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SwiftBite || Menu Management</title>
  </head>
  <body>
    <%- include("../partials/header.ejs") %>
    <div class="dashboard-container">
      <%- include("../partials/asideManager.ejs") %>
<main class="main-content">
  <div class="page-header">
    <h2>Menu Management</h2>
    <p>Manage your restaurant's digital menu and pricing</p>
  </div>
 <div id="toast" class="toast-hidden">
    <div class="toast-content">
        <div id="toast-message"></div> 
    </div>
</div>

  <% if (restaurant.status === 'approved') { %>
    <div class="settings-grid">
      <div class="form-card">
        <div class="card-title">
          <i class="fa-solid fa-plus-circle"></i>
          <h3>Add New Menu Item</h3>
        </div>
        
        <form action="/manager/add-menu" method="POST" enctype="multipart/form-data">
          <div class="input-group">
            <label>Dish Name</label>
            <input type="text" name="itemName" placeholder="e.g. Jollof Rice" required>
          </div>
          
          <div class="input-group">
            <label>Price (Le)</label>
            <input type="number" name="price" placeholder="0.00" required>
          </div>

          <div class="input-group">
            <label>Category</label>
            <select name="category" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #e2e8f0; background: #f8fafc;">
              <option value="breakfast">Breakfast</option>
              <option value="lunch">Lunch</option>
              <option value="dinner">Dinner</option>
              <option value="drinks">Drinks</option>
            </select>
          </div>

          <div class="input-group">
            <label>Food Image</label>
            <input type="file" name="foodImage" accept="image/*">
          </div>

          <button type="submit" class="btn-primary">Upload to Menu</button>
        </form>
      </div>

      <div class="table-card">
          <div class="card-title" style="padding: 20px;">
              <h3>Live Menu Items</h3>
          </div>
         <table class="custom-table">
    <thead>
        <tr>
            <th>ITEM</th>
            <th>PRICE</th>
            <th>STATUS</th>
            <th class="text-right">ACTION</th> </tr>
    </thead>
    <tbody>
        <% menuItems.forEach(item => { %>
            <tr>
                <td>
                    <div class="user-profile-info">
                        <div class="avatar-circle">
                            <% if (item.image_url) { %>
                                <img src="<%= item.image_url %>" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">
                            <% } else { %>
                                <i class="fa-solid fa-utensils"></i>
                            <% } %>
                        </div>
                        <div style="margin-left: 10px;">
                            <span class="user-name"><%= item.name %></span>
                        </div>
                    </div>
                </td>
                <td>Le <%= item.price %></td>
                <td><span class="status-pill active">Visible</span></td>
                <td class="text-right">
                    <form action="/manager/delete-menu/<%= item.id %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this item?');" style="display: inline;">
                        <button type="submit" class="btn-delete" style="background: none; border: none; color: #ef4444; cursor: pointer; font-size: 1.1rem;">
                            <i class="fa-solid fa-trash-can"></i>
                        </button>
                    </form>
                </td>
            </tr>
        <% }) %>
    </tbody>
</table>
      </div>
    </div>

  <% } else if (restaurant.status === 'pending') { %>
    <div class="empty-state">
      <i class="fa-solid fa-clock-rotate-left" style="color: #ffa000; background: #fff8e6;"></i>
      <h3>Application Under Review</h3>
      <p>The Admin is currently verifying your restaurant details. You will be able to add menus once your account is approved.</p>
    </div>

  <% } else { %>
    <div class="empty-state">
      <i class="fa-solid fa-store-slash"></i>
      <h3>No Restaurant Found</h3>
      <p>To start selling on SwiftBite, you must first register your restaurant for approval.</p>
      <br>
      <a href="/manager/apply" class="btn-primary" style="text-decoration: none; padding: 15px 30px;">Apply for Restaurant Account</a>
    </div>
  <% } %>
</main>    </div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const toast = document.getElementById('toast');
        const msgContainer = document.getElementById('toast-message');

        function showToast(message, type = 'error') {
            const finalMessage = message && message.length > 0 ? message : "An unexpected error occurred.";
            
            msgContainer.textContent = finalMessage;
            
            toast.className = type === 'error' ? 'toast-error toast-visible' : 'toast-success toast-visible';

            setTimeout(() => {
                toast.classList.replace('toast-visible', 'toast-hidden');
            }, 4000);
        }

        <% if (locals.error && error.length > 0) { %>
            showToast("<%= error %>", 'error');
        <% } %>
    });
</script>
  </body>
</html>
